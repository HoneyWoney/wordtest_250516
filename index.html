<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ë‹¨ì–´ ì˜¤ë‹µ í€´ì¦ˆ - 25.05.20</title>
  <style>
    body {
      margin:0; padding:0;
      background:#FFFAF0;
      font-family:'ë§‘ì€ ê³ ë”•','Apple SD Gothic Neo',sans-serif;
    }
    .container {
      max-width:500px;
      margin:40px auto;
      padding:20px;
      background:#fff;
      border-radius:20px;
      box-shadow:0 0 10px rgba(0,0,0,0.1);
      text-align:center;
    }
    h1 { margin-bottom:20px; color:#FF6F91; }
    button {
      margin:8px;
      padding:10px 20px;
      font-size:1em;
      border:none;
      border-radius:10px;
      cursor:pointer;
      background:#FFD3B6;
      transition:transform .1s;
    }
    button:hover { transform:scale(1.05); }
    input[type="text"] {
      padding:8px;
      font-size:1em;
      border:2px solid #FF6F91;
      border-radius:10px;
      width:80%;
    }
    #question-num { font-size:.9em; color:#AAA; }
    #question-area {
      margin:20px 0;
      font-size:1.3em;
      color:#FF6F91;
    }
    .options { display:flex; flex-direction:column; }
    .options button { background:#CBE7E0; }
    #feedback {
      margin:15px 0;
      font-size:1.1em;
      min-height:1.2em;
    }
    #next-btn { background:#A29BFE; }
    #result-screen h2 { color:#FF6F91; }
    #response { margin-top:10px; font-size:.9em; color:#333; }
  </style>
</head>
<body>
  <div class="container">

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="start-screen">
      <h1>ì˜ë‹¨ì–´ ì˜¤ë‹µ í€´ì¦ˆ</h1>
      <p>ì´ë¦„ì„ ì…ë ¥í•˜ê³  ì‹œì‘!</p>
      <input type="text" id="name-input" placeholder="ì´ë¦„"/>
      <br/>
      <button id="start-btn">ì‹œì‘í•˜ê¸°</button>
    </div>

    <!-- í€´ì¦ˆ í™”ë©´ -->
    <div id="quiz-screen" style="display:none;">
      <div id="question-num"></div>
      <div id="question-area"></div>
      <div class="options" id="options-area"></div>
      <div id="input-area" style="margin:10px 0;"></div>
      <div id="feedback"></div>
      <button id="next-btn" style="display:none;">ë‹¤ìŒ</button>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div id="result-screen" style="display:none;">
      <h2>ğŸ‰ ê²°ê³¼ ğŸ‰</h2>
      <p id="score-display"></p>
      <button id="submit-btn">ì ìˆ˜ ì „ì†¡</button>
      <p id="response"></p>
    </div>

  </div>

  <script>
    // ì²´í¬/ì»¬ëŸ¬í‘œì‹œëœ 37ê°œ ì˜¤ë‹µë§Œ
    const vocabList = [
      {word:"oval",        meaning:"íƒ€ì›í˜•ì˜"},
      {word:"ignorant",    meaning:"ë¬´ì§€í•œ, ë¬´ì‹í•œ"},
      {word:"beard",       meaning:"í„±ìˆ˜ì—¼"},
      {word:"wrist",       meaning:"ì†ëª©"},
      {word:"peculiar",    meaning:"ì´ìƒí•œ"},
      {word:"offensive",   meaning:"ê³µê²©ì ì¸"},
      {word:"sorrow",      meaning:"ìŠ¬í””"},
      {word:"terrible",    meaning:"ë”ì°í•œ"},
      {word:"ashamed",     meaning:"ë¶€ë„ëŸ¬ì›Œí•˜ëŠ”"},
      {word:"depression",  meaning:"ìš°ìš¸, ë¶ˆê²½ê¸°"},
      {word:"uneasy", meaning:"ë¶ˆì•ˆí•œ"},
      {word:"depressed",  meaning:"ìš°ìš¸í•œ"},
      {word:"weep",       meaning:"ìš¸ë‹¤"},
      {word:"relieve",    meaning:"ì™„í™”í•˜ë‹¤"},
      {word:"sentiment",  meaning:"ê°ì •"},
      {word:"relief",     meaning:"ì•ˆì‹¬"},
      {word:"jealous",    meaning:"ì§ˆíˆ¬í•˜ëŠ”"},
      {word:"nerve",      meaning:"ì‹ ê²½, ìš©ê¸°"},
      {word:"envious",    meaning:"ë¶€ëŸ¬ì›Œí•˜ëŠ”"},
      {word:"desperate",  meaning:"ì ˆë§ì ì¸"},
      {word:"resentful",  meaning:"ë¶„ê°œí•˜ëŠ”"},
      {word:"astound",    meaning:"ë†€ë¼ê²Œ í•˜ë‹¤"},
      {word:"panic",      meaning:"ê³µí¬ì— ì§ˆë¦¬ë‹¤"},
      {word:"anniversary", meaning:"ê¸°ë…ì¼"},
      {word:"obedient",    meaning:"ìˆœì¢…í•˜ëŠ”"},
      {word:"nurture",     meaning:"ì–‘ìœ¡í•˜ë‹¤"},
      {word:"mature",      meaning:"ì„±ìˆ™í•œ"},
      {word:"accompany",   meaning:"ë™í–‰í•˜ë‹¤"},
      {word:"spouse",      meaning:"ë°°ìš°ì"},
      {word:"impression",  meaning:"ì¸ìƒ"},
      {word:"attractive",  meaning:"ë§¤ë ¥ì ì¸, ì‚¬ëŒì„ ë„ëŠ”"},
      {word:"passive",     meaning:"ìˆ˜ë™ì ì¸"},
      {word:"confident",   meaning:"í™•ì‹ í•˜ëŠ”"},
      {word:"impatient",   meaning:"ì„±ê¸‰í•œ"},
      {word:"ambitious",   meaning:"ì•¼ë§ ìˆëŠ”"},
      {word:"elegant",     meaning:"ìš°ì•„í•œ"},
      {word:"arrogant",    meaning:"ì˜¤ë§Œí•œ"}
    ];

    let playerName = "";
    let currentSet = 1;
    let qIndex = 0;
    let score = 0;
    let startTime;

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    document.getElementById("start-btn").onclick = () => {
      const name = document.getElementById("name-input").value.trim();
      if (!name) { alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
      playerName = name;
      document.getElementById("start-screen").style.display = "none";
      document.getElementById("quiz-screen").style.display = "block";
      startTime = Date.now();
      runQuestion();
    };

    function runQuestion() {
      const total = vocabList.length;
      document.getElementById("question-num").innerText =
        `${currentSet}ì„¸íŠ¸: ${qIndex+1} / ${total}`;
      document.getElementById("feedback").innerText = "";
      document.getElementById("next-btn").style.display = "none";

      const item = vocabList[qIndex];
      const qa = document.getElementById("question-area");
      const opts = document.getElementById("options-area");
      const inpArea = document.getElementById("input-area");
      opts.innerHTML = "";
      inpArea.innerHTML = "";

      if (currentSet === 1) {
        // 1ì„¸íŠ¸: ê°ê´€ì‹
        qa.innerText = `ğŸ“ ë‹¨ì–´: ${item.word}`;
        const choices = shuffle([
          item.meaning,
          ...shuffle(vocabList.filter(v=>v.meaning!==item.meaning))
            .slice(0,3).map(v=>v.meaning)
        ]);
        choices.forEach(ch => {
          const btn = document.createElement("button");
          btn.innerText = ch;
          btn.onclick = () => checkMC(ch);
          opts.appendChild(btn);
        });
      } else {
        // 2~4ì„¸íŠ¸: ì£¼ê´€ì‹ ë¹ˆì¹¸ ì±„ìš°ê¸°
        qa.innerText = `ğŸ“ ëœ»: ${item.meaning}`;
        let ratio = currentSet===2?0.2 : currentSet===3?0.5 : 1.0;
        const masked = maskWord(item.word, ratio);
        const p = document.createElement("p");
        p.innerText = masked;
        inpArea.appendChild(p);
        const inp = document.createElement("input");
        inp.type="text"; inp.placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”";
        inpArea.appendChild(inp);
        const btn = document.createElement("button");
        btn.innerText="ì œì¶œ";
        btn.onclick = () => checkInput(inp.value.trim());
        inpArea.appendChild(btn);
      }
    }

    function maskWord(word, hideRatio) {
      const arr = word.split("");
      const hideCount = Math.floor(arr.length * hideRatio);
      const idxs = [];
      while (idxs.length < hideCount) {
        const i = Math.floor(Math.random() * arr.length);
        if (!idxs.includes(i)) idxs.push(i);
      }
      idxs.forEach(i => arr[i] = "_");
      return arr.join("");
    }

    function checkMC(choice) {
      const item = vocabList[qIndex];
      const fb = document.getElementById("feedback");
      if (choice === item.meaning) {
        score += 10;
        fb.innerText = "ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!";
      } else {
        fb.innerText = `âœ– í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µ: ${item.meaning}`;
      }
      document.getElementById("next-btn").style.display = "inline-block";
    }

    function checkInput(answer) {
      const item = vocabList[qIndex];
      const fb = document.getElementById("feedback");
      if (answer.toLowerCase() === item.word.toLowerCase()) {
        score += 10;
        fb.innerText = "ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!";
      } else {
        fb.innerText = `âœ– í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µ: ${item.word}`;
      }
      document.getElementById("next-btn").style.display = "inline-block";
    }

    document.getElementById("next-btn").onclick = () => {
      qIndex++;
      if (qIndex < vocabList.length) {
        runQuestion();
      } else if (currentSet < 4) {
        currentSet++;
        qIndex = 0;
        runQuestion();
      } else {
        showResult();
      }
    };

    function showResult() {
      document.getElementById("quiz-screen").style.display = "none";
      document.getElementById("result-screen").style.display = "block";
      const elapsed = Math.floor((Date.now() - startTime)/1000);
      document.getElementById("score-display").innerText =
        `${playerName}ë‹˜, ì´ì : ${score}ì  (ì†Œìš”: ${elapsed}ì´ˆ)`;
    }

    document.getElementById("submit-btn").onclick = () => {
      const elapsed = Math.floor((Date.now() - startTime)/1000);
      saveData("wrongVocabQuiz", playerName, score, elapsed);
    };

    function saveData(game, name, score, elapsedTime) {
      const FUNCTION_URL = "https://us-central1-record-f420d.cloudfunctions.net/report";
      const requestData = {
        game, name,
        score: parseInt(score, 10),
        elapsedTime: parseInt(elapsedTime, 10)
      };
      try {
        fetch(FUNCTION_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(requestData)
        })
        .then(res=>res.json().then(data=>{
          if (res.ok) {
            document.getElementById('response').innerText =
              `ì„±ê³µ: ${JSON.stringify(data, null,2)}`;
          } else {
            document.getElementById('response').innerText =
              `ì˜¤ë¥˜: ${JSON.stringify(data, null,2)}`;
          }
        }));
      } catch(err) {
        console.error(err);
        document.getElementById('response').innerText =
          `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err.message}`;
      }
    }
  </script>
</body>
</html>
